<!DOCTYPE html>
<html>
<head>
    <title>拼音搜索测试</title>
    <script src="https://unpkg.com/pinyin-pro@3.19.6/dist/index.js"></script>
</head>
<body>
    <h1>拼音搜索测试</h1>
    <input id="search" placeholder="输入搜索内容" />
    <div id="results"></div>
    
    <script>
        const { pinyin } = window.pinyinPro;
        
        const testUsers = [
            { name: '张三', id: '1' },
            { name: '李四', id: '2' },
            { name: '王五', id: '3' },
            { name: '赵六', id: '4' },
            { name: '项目经理', id: '5' }
        ];
        
        function fuzzySearch(searchText, targetText) {
            if (!searchText) return true;
            if (!targetText) return false;

            const search = searchText.toLowerCase();
            const target = targetText.toLowerCase();

            // 1. 直接匹配
            if (target.includes(search)) {
                return true;
            }

            // 2. 拼音搜索
            try {
                const targetPinyin = pinyin(target, { toneType: 'none', nonZh: 'consecutive' }).toLowerCase();
                const targetPinyinInitials = pinyin(target, { pattern: 'initial', nonZh: 'consecutive' }).toLowerCase();

                if (targetPinyin.includes(search) || targetPinyinInitials.includes(search)) {
                    return true;
                }
            } catch (e) {
                console.error("拼音转换失败", e);
            }
            
            return false;
        }
        
        function updateResults() {
            const searchValue = document.getElementById('search').value;
            const results = testUsers.filter(user => fuzzySearch(searchValue, user.name));
            
            document.getElementById('results').innerHTML = results.map(user => 
                `<div>${user.name} (ID: ${user.id})</div>`
            ).join('');
        }
        
        document.getElementById('search').addEventListener('input', updateResults);
        updateResults(); // 初始显示所有用户
    </script>
</body>
</html>