<!DOCTYPE html>
<html>
<head>
    <title>测试陈楠拼音搜索</title>
    <script src="https://unpkg.com/pinyin-pro@3.19.6/dist/index.js"></script>
</head>
<body>
    <h1>测试陈楠拼音搜索</h1>
    <input id="searchInput" placeholder="输入 chennan 或 cn" />
    <div id="results"></div>
    
    <script>
        const { pinyin } = window.PinyinPro;
        
        const users = [
            { name: "陈雨", id: "20416" },
            { name: "李明", id: "21614" },
            { name: "王芳", id: "25408" },
            { name: "张伟", id: "24533" },
            { name: "刘洋", id: "14670" },
            { name: "赵敏", id: "22231" },
            { name: "陈楠", id: "10001" }
        ];
        
        const fuzzySearch = (searchText, targetText) => {
            if (!searchText) return true;
            if (!targetText) return false;

            const search = searchText.toLowerCase();
            const target = targetText.toLowerCase();

            // 1. Direct inclusion check
            if (target.includes(search)) {
                return true;
            }

            // 2. Pinyin-based search
            try {
                const targetPinyin = pinyin(target, { toneType: 'none', nonZh: 'consecutive' }).toLowerCase();
                const targetPinyinInitials = pinyin(target, { pattern: 'initial', nonZh: 'consecutive' }).toLowerCase();

                if (targetPinyin.includes(search) || targetPinyinInitials.includes(search)) {
                    return true;
                }
            } catch (e) {
                console.error("Pinyin conversion failed", e);
            }
            
            return false;
        };
        
        const searchInput = document.getElementById('searchInput');
        const resultsDiv = document.getElementById('results');
        
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value;
            const filtered = users.filter(user => fuzzySearch(searchTerm, user.name));
            
            resultsDiv.innerHTML = '<h3>搜索结果:</h3>' + 
                filtered.map(user => `<div>${user.name} (${user.id})</div>`).join('');
                
            // 显示拼音信息
            if (searchTerm) {
                resultsDiv.innerHTML += '<h3>拼音测试:</h3>';
                users.forEach(user => {
                    const fullPinyin = pinyin(user.name, { toneType: 'none', nonZh: 'consecutive' });
                    const initials = pinyin(user.name, { pattern: 'initial', nonZh: 'consecutive' });
                    resultsDiv.innerHTML += `<div>${user.name}: ${fullPinyin} (${initials})</div>`;
                });
            }
        });
    </script>
</body>
</html>